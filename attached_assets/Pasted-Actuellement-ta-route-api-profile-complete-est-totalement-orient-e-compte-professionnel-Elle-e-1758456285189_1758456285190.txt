Actuellement ta route /api/profile/complete est totalement orientÃ©e â€œcompte professionnelâ€ :

Elle exige companyName et siret.

Si ces champs manquent, elle renvoie immÃ©diatement 400 Bad Request.
ğŸ‘‰ Donc un particulier qui envoie seulement name, phone, city, postalCode se fait bloquer.

âœ… Solution 1 (la plus propre) : sÃ©parer les routes

CrÃ©er deux routes distinctes :

app.post("/api/profile/complete/personal", async (req, res) => {
  // ici on gÃ¨re particuliers
});

app.post("/api/profile/complete/professional", async (req, res) => {
  // ton code actuel
});


Avantage : chaque route a ses propres validations â†’ pas de conflit.
InconvÃ©nient : Ã§a double un peu le code.

âœ… Solution 2 (rapide) : adapter la mÃªme route

On garde /api/profile/complete, mais on dÃ©tecte le type de compte :

app.post("/api/profile/complete", async (req, res) => {
  try {
    console.log("ğŸ”” CrÃ©ation/MÃ J profil...");
    const authHeader = req.headers.authorization;
    if (!authHeader) return res.status(401).json({ error: "Token manquant" });
    const token = authHeader.replace("Bearer ", "");
    const { data: { user }, error: authError } = await supabaseServer.auth.getUser(token);
    if (authError || !user) return res.status(401).json({ error: "Token invalide" });

    // champs reÃ§us
    const { companyName, siret, companyAddress, phone, email, website, description, name, city, postalCode } = req.body;

    if (companyName && siret) {
      // ğŸ‘‰ cas PRO
      if (!/^\d{14}$/.test(siret)) {
        return res.status(400).json({ error: "SIRET invalide (14 chiffres)" });
      }

      // upsert dans professional_accounts (ton code existant)
      // ...
      return res.json({ success: true, type: "professional" });

    } else {
      // ğŸ‘‰ cas PARTICULIER
      if (!name || !phone || !city || !postalCode) {
        return res.status(400).json({ error: "Champs obligatoires manquants" });
      }

      // upsert dans table users (ou personal_profiles)
      const { data, error } = await supabaseServer
        .from("users")
        .update({
          full_name: name,
          phone,
          city,
          postal_code: postalCode,
          updated_at: new Date().toISOString()
        })
        .eq("id", user.id)
        .select()
        .single();

      if (error) {
        console.error("âŒ Erreur sauvegarde particulier:", error);
        return res.status(500).json({ error: "Erreur sauvegarde compte personnel" });
      }

      return res.json({ success: true, type: "personal", profile: data });
    }

  } catch (err) {
    console.error("âŒ Erreur API /api/profile/complete:", err);
    return res.status(500).json({ error: "Erreur serveur interne" });
  }
});


ğŸ‘‰ ConcrÃ¨tement :

Si companyName + siret prÃ©sents â†’ compte pro (ton code actuel).

Sinon â†’ compte particulier, on fait un update dans users.