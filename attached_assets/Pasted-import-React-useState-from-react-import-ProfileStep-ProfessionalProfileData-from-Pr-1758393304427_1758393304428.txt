import React, { useState } from "react";
import { ProfileStep, ProfessionalProfileData } from "./ProfileStep";
import { VerificationStep } from "./VerificationStep"; // ✅ nouvel import
import { SubscriptionStep } from "./SubscriptionStep";

interface OnboardingRouterProps {
  setShowProfileSetup: (value: boolean) => void;
}

export const OnboardingRouter: React.FC<OnboardingRouterProps> = ({
  setShowProfileSetup,
}) => {
  const [currentStep, setCurrentStep] = useState(1);
  const [savedFormData, setSavedFormData] = useState<any>({});
  const [accountType, setAccountType] = useState<"particulier" | "pro" | null>(
    null,
  );

  // Étape 1 → Étape 2 (ProfileStep → VerificationStep si Pro, sinon fin)
  const handleProfileNext = (
    data: ProfessionalProfileData,
    type: "particulier" | "pro",
  ) => {
    setSavedFormData(data);
    setAccountType(type);

    if (type === "pro") {
      setCurrentStep(2); // Aller vers VerificationStep
    } else {
      // Particulier : profil terminé immédiatement
      setShowProfileSetup(false);
    }
  };

  // Étape 2 → Étape 3 (VerificationStep → SubscriptionStep)
  const handleVerificationComplete = () => {
    setCurrentStep(3);
  };

  // Étape 3 → Fin (Stripe redirection se fait dans SubscriptionStep)
  const handleSubscriptionComplete = () => {
    setShowProfileSetup(false); // ferme le modal après paiement
  };

  return (
    <div className="p-6">
      {currentStep === 1 && (
        <ProfileStep
          onNext={handleProfileNext}
          onCancel={() => setShowProfileSetup(false)}
        />
      )}

      {currentStep === 2 && accountType === "pro" && (
        <VerificationStep
          onBack={() => setCurrentStep(1)}
          onComplete={handleVerificationComplete}
        />
      )}

      {currentStep === 3 && accountType === "pro" && (
        <SubscriptionStep
          onBack={() => setCurrentStep(2)}
          onComplete={handleSubscriptionComplete}
        />
      )}
    </div>
  );
};
