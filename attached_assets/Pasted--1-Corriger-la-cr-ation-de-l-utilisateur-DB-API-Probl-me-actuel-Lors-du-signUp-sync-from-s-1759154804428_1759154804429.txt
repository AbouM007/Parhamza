âš™ï¸ 1. Corriger la crÃ©ation de lâ€™utilisateur (DB & API)
ProblÃ¨me actuel

Lors du signUp â†’ sync-from-signup, tu enregistres lâ€™utilisateur avec profile_completed = true et onboarding_status = completed.

RÃ©sultat : lâ€™onboarding est court-circuitÃ© dÃ¨s la crÃ©ation.

Correction Ã  faire

ğŸ‘‰ Dans ton endpoint /api/users/sync-from-signup :

Par dÃ©faut, insÃ©rer toujours :

profile_completed = false
onboarding_status = 'incomplete_profile'


Câ€™est seulement aprÃ¨s validation du formulaire que tu passes en true + completed.

ğŸ–¥ï¸ 2. Corriger la logique cÃ´tÃ© AuthContext / App
ProblÃ¨me actuel

App.tsx lit profile.profile_completed pour dÃ©cider de lâ€™onboarding.

Comme la DB envoie dÃ©jÃ  true, lâ€™onboarding saute.

Correction Ã  faire

Harmoniser avec le champ camelCase :

const minimalUser = {
  id: profile.id,
  type: profile.type as "individual" | "professional" | "admin" | null,
  profile_completed: profile.profileCompleted, // âœ… camelCase cÃ´tÃ© TS
};


Ajouter une rÃ¨gle dans detectOnboardingState :

Si profile_completed = false â†’ forcer lâ€™affichage du popup (personal ou professional).

Si profile_completed = true â†’ fermer le popup.

ğŸ“ 3. Corriger le rendu des formulaires UI
ProblÃ¨me actuel

Le PersonalProfileForm sâ€™ouvre mais reste vide â†’ tu passes seulement name et email.

Correction Ã  faire

Passer toutes les infos disponibles en initialData :

<PersonalProfileForm
  isOpen={showProfileSetup && onboardingStep === "personal"}
  onClose={() => setOnboardingStep("choice")}
  onComplete={async () => {
    setShowProfileSetup(false);
    setOnboardingStep("choice");
    await refreshProfile(); // âœ… mettre Ã  jour aprÃ¨s sauvegarde
  }}
  initialData={{
    name: profile?.name,
    email: profile?.email,
    phone: profile?.phone ?? "",
    city: profile?.city ?? "",
    postal_code: profile?.postal_code ?? "",
  }}
/>


VÃ©rifier dans PersonalProfileForm.tsx que ces champs existent et sont bien bindÃ©s Ã  initialData.

âœ… RÃ©sultat attendu

Nouvel utilisateur crÃ©Ã© â†’ dans DB : profile_completed = false.

Popup onboarding â†’ sâ€™affiche correctement.

Formulaire personnel â†’ prÃ©-rempli avec email, nom, tÃ©lÃ©phone, etc.

Ã‰tape professionnelle â†’ sâ€™affiche correctement tant que profile_completed = false.

AprÃ¨s validation â†’ API met Ã  jour profile_completed = true + onboarding_status = completed.