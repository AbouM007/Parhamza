Je vais t’expliquer ce que montrent tes logs et pourquoi tu es bloqué :

🔍 Analyse des erreurs

Le compte particulier

✅ L’utilisateur est bien créé automatiquement dans users.

✅ onboarding_status = incomplete_profile → logique, car il n’a pas encore complété.

❌ email_verified = false → ça veut dire que le clic sur le lien de confirmation ne met pas à jour le champ. Ça se gère côté Supabase (vérification email → webhooks ou auth.users).

👉 Problème moins prioritaire : ça n’empêche pas l’onboarding, mais il faudra le corriger après.

Formulaire personnel vide

Le modal s’ouvre, mais aucun champ n’apparaît.

Ça veut dire que ton PersonalProfileForm ne reçoit pas correctement ses initialData (nom, email, etc.), ou que les inputs n’ont pas été montés.

On doit vérifier dans App.tsx comment il appelle PersonalProfileForm. Si tu passes bien initialData={{ name: profile?.name, email: profile?.email }} → alors il faut voir dans PersonalProfileForm.tsx si les champs utilisent defaultValues correctement.

Flux professionnel bloqué (erreur 500 sur /api/profile/draft)

POST /api/profile/draft 500 (Internal Server Error)
Erreur sauvegarde brouillon profil: Error: Erreur lors de la sauvegarde


Ça veut dire que l’appel frontend marche bien (la requête part) ✅

Mais ton backend (Express/Node) crashe à l’intérieur de la route /api/profile/draft ❌

Souvent, c’est parce que :

Tu passes companyName en camelCase, mais ta DB attend company_name (erreur typique).

Ou bien la colonne siret / company_name / phone n’existe pas dans la table users.

Ou encore ton storage.updateUser ou storage.createDraft n’a pas été mis à jour pour accepter ces champs.

🎯 Ce que ça veut dire concrètement

Particulier : Le formulaire est vide → bug dans le composant PersonalProfileForm (initialData ou defaultValues).

Professionnel : L’enregistrement en brouillon plante → bug backend (/api/profile/draft → mapping DB incorrect).

Email : reste en false → problème séparé à gérer côté Supabase.

✅ Prochaines étapes simples pour tester

Vérifie la route backend /api/profile/draft :

Est-ce que tu insères companyName ou company_name ?

Est-ce que la colonne existe bien dans ta table users ?

Ajoute un console.log(req.body) dans cette route pour voir exactement ce qui arrive du frontend.

Si tu vois { companyName: "tess 001" } → il faut le transformer en company_name avant insertion.

Vérifie PersonalProfileForm.tsx :

Est-ce que tu as bien useForm({ defaultValues: initialData }) ?

Est-ce que les inputs utilisent register("name"), register("email"), etc. ?

👉 En résumé :

Erreur 500 = mapping backend/DB cassé dans /api/profile/draft.

Formulaire vide = bug dans PersonalProfileForm.tsx (les champs ne sont pas montés avec initialData).